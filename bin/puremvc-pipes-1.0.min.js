(function(q){function f(){}function c(a){if(a)this.type=a.type,this.header=a.header,this.body=a.body,this.priority=a.priority}function i(a){if(a)this.type=a.type,this.name=a.name,this.filter=a.filter,this.params=a.params}function j(a){if(a)this.type=a.type}function n(){}function l(a){if(a)this.context=a.context,this.listener=a.listener}function k(a){a&&this.connect(a.output)}function g(a){if(a&&(this.mode=g.FILTER,this.params=[],this.filter=function(){},a))this.name=a.name,this.output=a.output,void 0!=
a.filter&&this.setFilter(a.filter),null!=a.params&&this.setParams(a.params)}function e(){this.inputPipes=[];this.outputPipes=[];this.pipesMap=[];this.pipeTypesMap=[]}function h(){}function r(){}function m(){this.mode=j.SORT;this.messages=[]}function p(a){a&&(a.input1&&this.connectInput(a.input1),a.input2&&this.connectInput(a.input2))}function o(a){a&&(a.output1&&this.connect(a.output1),a.output2&&this.connect(a.output2));this.outputs=[]}null==q&&(q=window);if(!q.puremvc.pipes)f.NAME="PipeMessage",
f.constructor=f,f.prototype.getType=function(){return this.type},f.prototype.setType=function(a){this.type=a},f.prototype.getHeader=function(){return this.header},f.prototype.setHeader=function(a){this.header=a},f.prototype.getBody=function(){return this.body},f.prototype.setBody=function(a){this.body=a},f.prototype.getPriority=function(){return this.priority},f.prototype.setPriority=function(a){this.priority=a},f.prototype.type=null,f.prototype.header=null,f.prototype.body=null,f.prototype.priority=
null,c.NAME="Message",c.prototype=new f,c.prototype.constructor=c,c.PRIORITY_HIGH=1,c.PRIORITY_MED=5,c.PRIORITY_LOW=10,c.BASE="http://puremvc.org/namespaces/pipes/messages/",c.NORMAL="http://puremvc.org/namespaces/pipes/messages/normal/",i.NAME="FilterControlMessage",i.prototype=new c,i.prototype.constructor=i,i.prototype.name=null,i.prototype.filter=null,i.prototype.params=null,i.BASE=c.BASE+"filter-control/",FilterControlMessageSET_PARAMS=c.BASE+"setparams",FilterControlMessageSET_FILTER=c.BASE+
"setfilter",FilterControlMessageBYPASS=c.BASE+"bypass",FilterControlMessageFILTER=c.BASE+"filter",j.NAME="QueueControlMessage",j.prototype=new c,j.prototype.constructor=j,j.BASE=c.BASE+"/queue/",j.FLUSH=c.BASE+"flush",j.SORT=c.BASE+"sort",j.FIFO=c.BASE+"fifo",n.NAME="PipeFitting",n.prototype.constructor=n,n.prototype.connect=function(){},n.prototype.disconnect=function(){},n.prototype.write=function(){},l.NAME="PipeListener",l.prototype=new n,l.prototype.constructor=l,l.prototype.context=null,l.prototype.listener=
null,l.prototype.connect=function(){return!1},l.prototype.disconnect=function(){return null},l.prototype.write=function(a){this.listener.apply(this.context,[a]);return!0},k.NAME="Pipe",k.prototype=new n,k.prototype.constructor=k,k.prototype.output=null,k.prototype.connect=function(a){var b=!1;if(void 0==this.output)this.output=a,b=!0;return b},k.prototype.disconnect=function(){var a=this.output;this.output=void 0;return a},k.prototype.write=function(a){return this.output.write(a)},g.NAME="Filter",
g.prototype=new k,g.prototype.constructor=g,g.prototype.mode=null,g.prototype.params=null,g.prototype.name=null,g.prototype.filter=null,g.prototype.write=function(a){var b,d=!0;switch(a.type){case c.NORMAL:try{b=this.mode==i.FILTER?this.applyFilter(a):a,d=this.output.write(b)}catch(e){d=!1}break;case i.SET_PARAMS:this.isTarget(a)?this.setParams(a.params):d=this.output.write(b);break;case i.SET_FILTER:this.isTarget(a)?this.setFilter(a.filter):d=this.output.write(b);break;case i.BYPASS:case i.FILTER:this.isTarget(a)?
this.mode=a.type:d=this.output.write(a);break;default:d=this.output.write(b)}return d},g.prototype.isTarget=function(a){return a.name==this.name},g.prototype.setParams=function(a){this.params=a},g.prototype.setFilter=function(a){this.filter=a},g.prototype.applyFilter=function(a){this.filter.apply(this,[a,this.params]);return a},e.NAME="Junction",e.prototype.constructor=e,e.prototype.inputPipes=null,e.prototype.outputPipes=null,e.prototype.pipesMap=null,e.prototype.pipeTypesMap=null,e.prototype.registerPipe=
function(a,b,d){var c=!0;if(void 0==this.pipesMap[a])switch(this.pipesMap[a]=d,this.pipeTypesMap[a]=b,b){case e.INPUT:this.inputPipes.push(a);break;case e.OUTPUT:this.outputPipes.push(a);break;default:c=!1}else c=!1;return c},e.prototype.hasPipe=function(a){return void 0!=this.pipesMap[a]},e.prototype.hasInputPipe=function(a){return this.hasPipe(a)&&"input"==this.pipeTypesMap[a]},e.prototype.hasOutputPipe=function(a){return this.hasPipe(a)&&"output"==this.pipeTypesMap[a]},e.prototype.removePipe=function(a){if(this.hasPipe(a)){var b=
[];switch(this.pipeTypesMap[a]){case e.INPUT:b=this.inputPipes;break;case e.OUTPUT:b=this.outputPipes}for(var d=0;d<b.length;d++)if(b[d]==a){b.splice(d,1);break}this.pipesMap.splice(this.pipesMap.indexOf(a),1);this.pipeTypesMap.splice(this.pipeTypesMap.indexOf(a),1)}},e.prototype.retrievePipe=function(a){return this.pipesMap[a]},e.prototype.addPipeListener=function(a,b,d){var c=!1;this.hasInputPipe(a)&&(c=this.pipesMap[a].connect(new l({context:b,listener:d})));return c},e.prototype.sendMessage=function(a,
b){var d=!1;this.hasOutputPipe(a)&&(d=this.pipesMap[a].write(b));return d},e.INPUT="input",e.OUTPUT="output",h.NAME="JunctionMediator",h.prototype=new puremvc.Mediator,h.prototype.constructor=h,h.prototype.listNotificationInterests=function(){return[h.ACCEPT_INPUT_PIPE,h.ACCEPT_OUTPUT_PIPE]},h.prototype.handleNotification=function(a){switch(a.getName()){case h.ACCEPT_INPUT_PIPE:var b=a.getType(),a=a.getBody();this.getJunction().registerPipe(b,e.INPUT,a)&&this.getJunction().addPipeListener(b,this,
this.handlePipeMessage);break;case h.ACCEPT_OUTPUT_PIPE:b=a.getType(),a=a.getBody(),this.getJunction().registerPipe(b,e.OUTPUT,a)}},h.prototype.handlePipeMessage=function(){},h.prototype.getJunction=function(){return this.viewComponent},h.ACCEPT_INPUT_PIPE="acceptInputPipe",h.ACCEPT_OUTPUT_PIPE="acceptOutputPipe",r.NAME="PipeAware",r.prototype.acceptInputPipe=function(){},r.prototype.acceptOutputPipe=function(){},m.NAME="Queue",m.prototype=new k,m.prototype.constructor=m,m.prototype.mode=null,m.prototype.message=
null,m.prototype.write=function(a){var b=!0;switch(a.getType()){case c.NORMAL:this.store(a);break;case j.FLUSH:b=this.flush();break;case j.SORT:case j.FIFO:this.mode=a.getType()}return b},m.prototype.store=function(a){this.messages.push(a);this.mode==j.SORT&&this.message.sort(sortMessageByPriority)},m.prototype.sortMessagesByPriority=function(a,b){var d=0;a.getPriority()<b.getPriority()?d=-1:a.getPriority()>b.getPriority()&&(d=1);return d},m.prototype.flush=function(){for(var a=!1,b=this.messages.shift();void 0!=
b;)this.output.write(b)||(a=!1),b=this.messages.shift();return a},p.NAME="TeeMerge",p.prototype=new k,p.prototype.constructo=p,p.prototype.connectInput=function(a){return a.connect(this)},o.NAME="TeeSplit",o.prototype=new n,o.prototype.constructor=o,o.prototype.output=null,o.prototype.connect=function(a){this.outputs.push(a);return!0},o.prototype.disconnect=function(){return this.outputs.pop()},o.prototype.disconnectFitting=function(a){for(var b,d=0;d<this.outputs.length;d++){var c=this.outputs[d];
if(c==a){this.outputs.splice(d,1);b=c;break}}return b},o.prototype.write=function(a){for(var b=!0,c=0;c<this.outputs.length;c++)this.outputs[c].write(a)||(b=!1);return b},q.puremvc.pipes={PipeMessage:f,Message:c,FilterControlMessage:i,QueueControlMessage:j,PipeFitting:n,PipeListener:l,Pipe:k,Filter:g,Junction:e,JunctionMediator:h,PipeAware:r,Queue:m,TeeMerge:p,TeeSplit:o}})(this);